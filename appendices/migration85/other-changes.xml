<?xml version="1.0" encoding="utf-8"?>
<!-- EN-Revision: 6b48f364497107ae46f926bfc99a4e3d9d546316 Maintainer: mowangjuanzi Status: ready -->
<sect1 xml:id="migration85.other-changes">
 <title>其它变更</title>

 <sect2 xml:id="migration85.other-changes.core">
  <title>核心变更</title>

  <sect3 xml:id="migration85.other-changes.core.core">
   <title>核心</title>

   <simpara>
    macOS 上的高精度计时器（<function>hrtime</function>）现已采用推荐的 <code>clock_gettime_nsec_np(CLOCK_UPTIME_RAW)</code>
    API，取代原先的 <code>mach_absolute_time()</code>。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.core.cgi-cli">
   <title>CGI/CLI</title>

   <simpara>
    已移除 <option>-z</option> 或 <option>--zend-extension</option>
    选项，因其不具备实际功能；应改用 <option>-d zend_extension=[path]</option>。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.core.pdo-odbc">
   <title>PDO_ODBC</title>

   <simpara>
    大列的获取行为已调整。PDO_ODBC 不再以 256
    字节块为单位获取数据，而是尝试获取更大的块大小；当前该大小为页面大小减去字符串开销。同时，对在
    SQLGetData 中返回 SQL_NO_TOTAL 的驱动程序也做了更好支持。此举有助于提升兼容性与性能。
    <!-- See: GH-10809, GH-10733 -->
   </simpara>

  </sect3>

 </sect2>

 <sect2 xml:id="migration85.other-changes.sapi">
  <title>SAPI 模块的变更</title>

  <sect3 xml:id="migration85.other-changes.sapi.cli">
   <title>CLI</title>

   <simpara>
    使用 <function>cli_set_process_title</function> 设置过长的进程标题时，现在会失败，而非静默截断指定标题。
   </simpara>

   <simpara>
    新增 <option>--ini=diff</option> 选项，用于输出与内置默认值不同的 INI 配置项。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.sapi.fpm">
   <title>FPM</title>

   <simpara>
    FPM 在配合 httpd ProxyPass 使用时，可选地对完整脚本路径进行解码。新增
    <!-- <link linkend="ini.fastcgi.script_path_encoded"-->fastcgi.script_path_encoded<!-- </link> --> 
    INI 配置项，用于禁用此新行为。
   </simpara>

   <simpara>
    FPM 访问日志长度限制现已遵循 <link linkend="log-limit">log_limit</link> 配置值。
   </simpara>

  </sect3>

 </sect2>

 <sect2 xml:id="migration85.other-changes.functions">
  <title>函数变更</title>

  <sect3 xml:id="migration85.other-changes.functions.intl">
   <title>Intl</title>

   <simpara>
    <function>grapheme_extract</function> 在跳过无效起始字节时，现已正确设置 <parameter>$next</parameter>
    的值。此前在某些情况下，该值会指向字母边界起始位置，而非结束位置。
   </simpara>

   <simpara>
    <function>transliterator_get_error_code</function>、<function>transliterator_get_error_message</function>、<methodname>TransLiterator::getErrorCode</methodname>
    和 <methodname>TransLiterator::getErrorMessage</methodname> 已从返回类型联合中移除 &false;，因为实际上这些函数可能从未返回 &false;。
   </simpara>

   <simpara>
    以下函数现已支持 <parameter>$locale</parameter>：<function>grapheme_strpos</function>、<function>grapheme_stripos</function>、<function>grapheme_strrpos</function>、<function>grapheme_strripos</function>、<function>grapheme_substr</function>、<function>grapheme_strstr</function>
    和 <function>grapheme_stristr</function>
    <!-- RFC: https://wiki.php.net/rfc/grapheme_add_locale_for_case_insensitive -->
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.functions.ldap">
   <title>LDAP</title>

   <simpara>
    <function>ldap_get_option</function> 现在支持传入 &null; 连接（与 <function>ldap_set_option</function> 一致），以便获取全局选项。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.functions.libxml">
   <title>libxml</title>

   <simpara>
    <function>libxml_set_external_entity_loader</function> 现在具有正式的返回类型 <type>true</type>。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.functions.openssl">
   <title>OpenSSL</title>

   <simpara>
    <function>openssl_public_encrypt</function> 和 <function>openssl_private_decrypt</function> 新增
    <parameter>$digest_algo</parameter> 参数，用于指定 OAEP 填充所使用的散列摘要算法。
   </simpara>

   <simpara>
    <function>openssl_sign</function> 和 <function>openssl_verify</function> 新增
    <parameter>$padding</parameter> 参数，以支持使用更安全的 RSA PSS 填充方式。
   </simpara>

   <simpara>
    <function>openssl_cms_encrypt</function> 的 <parameter>$cipher_algo</parameter>
    参数现可接受表示加密算法名称的字符串，从而支持更多算法，包括用于认证加密数据的 AES-GCM 系列算法。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.functions.pcntl">
   <title>PCNTL</title>

   <simpara>
    <function>pcntl_exec</function> 现在具有正式的返回类型 <type>false</type>。
   </simpara>

   <simpara>
    <function>pcntl_waitid</function> 新增 resource_usage 参数，用于收集关于子进程的各类平台特定资源使用指标。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.functions.pdo-pgsql">
   <title>PDO_PGSQL</title>

   <simpara>
    <methodname>Pdo\Pgsql::copyFromArray</methodname> 现在支持 <type>iterable</type> 输入。
   </simpara>

   <simpara>
    <methodname>Pdo\Pgsql::setAttribute</methodname> 和 <methodname>Pdo\Pgsql::prepare</methodname>
    支持将 <constant>PDO::ATTR_PREFETCH</constant> 设为 0，以启用延迟获取模式。在此模式下，语句无法并行执行。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.functions.pgsql">
   <title>PostgreSQL</title>

   <simpara>
    <function>pg_copy_from</function> 现在支持 <type>iterable</type> 输入。
   </simpara>

   <simpara>
    <function>pg_connect</function> 会检查 connection_string 参数是否包含 null 字节。
   </simpara>

   <simpara>
    <function>pg_close_stmt</function> 会检查 statement_name 参数是否包含 null 字节。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.functions.posix">
   <title>POSIX</title>

   <simpara>
    <function>posix_ttyname</function> 在遇到无效文件描述符时，会将 last_error 设置为 EBADF。
   </simpara>

   <simpara>
    当 <function>posix_isatty</function> 遇到无效文件描述符时，会触发 <constant>E_WARNING</constant> 消息。
   </simpara>

   <simpara>
    <function>posix_fpathconf</function> 会检查无效的文件描述符，并将 last_error 设置为
    EBADF，同时触发 <constant>E_WARNING</constant> 消息。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.functions.reflection">
   <title>Reflection</title>

   <simpara>
    <methodname>ReflectionClass::__toString</methodname>
    对枚举的输出已调整，以更清晰地表明该类为枚举类型，并说明其中的枚举项属于枚举成员，而非普通类常量。
   </simpara>

   <simpara>
    对于带有挂钩的属性，<methodname>ReflectionProperty::__toString</methodname>
    的输出已调整，以标明该属性包含哪些挂钩、这些挂钩是否为 final，以及该属性是否为虚拟属性。当类中包含带挂钩的属性时，<methodname>ReflectionClass::__toString</methodname>
    的输出也会相应变化。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.functions.sockets">
   <title>Sockets</title>

   <simpara>
    <function>socket_create</function>/<function>socket_bind</function> 可创建 <constant>AF_PACKET</constant> 协议族的套接字。
   </simpara>

   <simpara>
    <function>socket_getsockname</function> 可获取 <constant>AF_PACKET</constant> 套接字的接口索引及其字符串表示形式。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.functions.zlib">
   <title>Zlib</title>

   <simpara>
    <function>gzfile</function>、<function>gzopen</function> 和 <function>readgzfile</function>
    函数的 <parameter>$use_include_path</parameter> 参数已从 <type>int</type> 类型改为 <type>bool</type> 类型。
   </simpara>

   <simpara>
    <function>gzfile</function>、<function>gzopen</function> 和 <function>readgzfile</function> 函数现已遵循默认的 stream 上下文。
   </simpara>

  </sect3>

 </sect2>

 <sect2 xml:id="migration85.other-changes.extensions">
  <title>扩展的其他变更</title>

  <sect3 xml:id="migration85.other-changes.extensions.curl">
   <title>cURL</title>

   <simpara>
    <function>curl_setopt</function> 中 <constant>CURLOPT_FOLLOWLOCATION</constant> 选项的值不再视为
    bool 类型，而是作为 int 类型处理，以支持 <constant>CURLFOLLOW_OBEYCODE</constant> 和
    <constant>CURLFOLLOW_FIRSTONLY</constant>。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.extensions.fileinfo">
   <title>Fileinfo</title>

   <simpara>
    file 已从 5.45 升级至 5.46。
   </simpara>

   <simpara>
    <function>finfo_close</function> 的返回类型已从 <type>bool</type> 改为 <type>true</type>。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.extensions.intl">
   <title>Intl</title>

   <simpara>
    Intl 的内部错误机制已现代化，能够更准确地指示哪个调用位置引发了何种错误。此外，部分
    ext/date 抛出的异常现已封装在 <classname>IntlException</classname> 中。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.extensions.lexbor">
   <title>Lexbor</title>

   <simpara>
    新增始终启用的 lexbor 扩展，其中包含从 <link linkend="book.dom">ext/dom</link>
    中分离出来的 lexbor 库，以便在其他扩展中复用。该新扩展不直接向用户空间暴露。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.extensions.opcache">
   <title>Opcache</title>

   <simpara>
    <link linkend="book.opcache">Opcache 扩展</link>现已始终内置于 PHP 二进制文件中并自动加载，仍会遵循
    INI 配置项 <link linkend="ini.opcache.enable">opcache.enable</link> 和 <link
    linkend="ini.opcache.enable-cli">opcache.enable_cli</link>。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.extensions.pcre">
   <title>PCRE</title>

   <simpara>
    pcre2lib 已从 10.44 升级至 10.46。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.extensions.pdo-sqlite">
   <title>PDO_Sqlite</title>

   <simpara>
    最低支持的发布版本已从 3.7.7 提升至 3.7.17。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.extensions.readline">
   <title>Readline</title>

   <simpara>
    <function>readline_add_history</function>、<function>readline_clear_history</function>
    和 <function>readline_callback_handler_install</function> 的返回类型已从 <type>bool</type> 改为 <type>true</type>。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.extensions.reflection">
   <title>Reflection</title>

   <simpara>
    <classname>ReflectionConstant</classname> 不再是 final 类。
   </simpara>

  </sect3>

 </sect2>

 <sect2 xml:id="migration85.other-changes.ini">
  <title>INI 文件处理的变更</title>

  <sect3 xml:id="migration85.other-changes.ini.core">
   <title>Core</title>

   <simpara>
    新增 fatal_error_backtraces 配置项，用于控制致命错误是否包含回溯信息。
    <!-- RFC: https://wiki.php.net/rfc/error_backtraces_v2 -->
   </simpara>

   <simpara>
    新增仅在启动时生效的 max_memory_limit INI 配置项，用于限制 memory_limit
    在启动或运行时可设置的最大值。若超过该值（除非设为 -1），将发出警告，并将
    memory_limit 设为当前的 max_memory_limit 值。
    <!-- ML discussion: https://externals.io/message/127108 -->
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.ini.opcache">
   <title>Opcache</title>

   <simpara>
    新增 opcache.file_cache_read_only 配置项，用于支持只读的 <link linkend="ini.opcache.file-cache">opcache.file_cache</link>
    目录，适用于只读文件系统（例如只读 Docker 容器）。建议配合
    <literal>opcache.validate_timestamps=0</literal>、<literal>opcache.enable_file_override=1</literal>
    和 <literal>opcache.file_cache_consistency_checks=0</literal> 使用。
   </simpara>

   <note>
    <simpara>
     由不同版本的 PHP 构建、不同文件路径或不同配置（包括加载的扩展）生成的缓存可能不会使用。
    </simpara>
   </note>

   <simpara>
    <link linkend="ini.opcache.jit-hot-loop">opcache.jit_hot_loop</link>
    的默认值现为 61（质数），以避免其成为循环迭代次数的倍数。建议将此参数设为质数。
   </simpara>

   <simpara>
    当 OPcache SHM 已设置好后修改 <link linkend="ini.opcache.memory-consumption">opcache.memory_consumption</link>
    将正确报告失败，而非静默无操作并在 phpinfo() 中显示误导性的值。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.ini.openssl">
   <title>OpenSSL</title>

   <simpara>
    新增 <!-- <link linkend="ini.openssl.libctx"-->openssl.libctx<!-- </link> -->，用于选择
    OpenSSL 库上下文类型。可为每个线程使用独立的自定义 libctx，或使用单一的全局 libctx（默认）。
   </simpara>

  </sect3>

 </sect2>

 <sect2 xml:id="migration85.other-changes.performance">
  <title>性能</title>

  <sect3 xml:id="migration85.other-changes.performance.core">
   <title>核心</title>

   <simpara>
    移除了针对布尔值的恒等比较操作码，尤其是用于 <code>match(true)</code> 模式的操作码。
   </simpara>

   <simpara>
    为 <code>=== []</code> 和 <code>!== []</code> 比较操作新增了 OPcode 专用优化。
   </simpara>

   <simpara>
    创建异常对象的速度现已显著提升。
   </simpara>

   <simpara>
    代码中使用 SSE2 的部分现已适配，同时支持 ARM NEON 的 SIMD 指令。
   </simpara>

   <simpara>
    引入了 TAILCALL VM，在使用 Clang>=19 上编译 x86_64 或 aarch64 架构时默认启用。TAILCALL VM
    的性能与使用 GCC 编译时采用的 HYBRID VM 相当，使得 Clang>=19 构建的 PHP 二进制文件性能达到
    GCC 构建版本的水平。此外，其他编译器所使用的 CALL VM 性能也显著提升。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.performance.intl">
   <title>Intl</title>

   <simpara>
    现在在将字符串转换为整理器使用时，避免了创建额外的字符串副本。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.performance.mbstring">
   <title>MBString</title>

   <simpara>
    代码中使用 SSE2 的部分现已适配，同时支持 ARM NEON 的 SIMD 指令。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.performance.opcache">
   <title>Opcache</title>

   <simpara>
    在非 Glibc 构建中，JIT 编译代码获取 TLS 变量的性能得到提升。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.performance.reflection">
   <title>Reflection</title>

   <para>
    以下方法的性能得到提升：
    <simplelist>
     <member><methodname>ReflectionProperty::getValue</methodname></member>
     <member><methodname>ReflectionProperty::getRawValue</methodname></member>
     <member><methodname>ReflectionProperty::isInitialized</methodname></member>
     <member><methodname>ReflectionProperty::isInitialized</methodname></member>
     <member><methodname>ReflectionProperty::setValue</methodname></member>
     <member><methodname>ReflectionProperty::setRawValue</methodname></member>
    </simplelist>
   </para>

  </sect3>

  <sect3 xml:id="migration85.other-changes.performance.spl">
   <title>SPL</title>

   <simpara>
    <classname>SplFixedArray</classname> 的维度访问器和方法性能得到提升。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.performance.standard">
   <title>标准</title>

   <simpara>
    带有回调函数的数组操作函数（如
    <function>array_find</function>、<function>array_filter</function>、<function>array_map</function>、<function>usort</function>
    等）性能得到提升。
   </simpara>

   <simpara>
    <function>urlencode</function> 和 <function>rawurlencode</function> 的性能得到提升。
   </simpara>

   <simpara>
    <function>unpack</function> 在处理无名称重复项时性能得到提升，通过避免创建临时字符串并重复解析。
   </simpara>

   <simpara>
    提升 <function>pack</function> 性能。
   </simpara>

   <simpara>
    <function>array_chunk</function> 的性能有小幅提升。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.other-changes.performance.xml">
   <title>XML</title>

   <simpara>
    提升 <classname>XMLReader</classname> 属性访问性能。
   </simpara>

   <simpara>
    提升 <classname>XMLWriter</classname> 的性能，内存占用有所降低。
   </simpara>

  </sect3>

 </sect2>

</sect1>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
