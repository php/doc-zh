<?xml version="1.0" encoding="utf-8"?>
<!-- EN-Revision: ec45af749649dc0d6a23eaedeed1b601f7460813 Maintainer: mowangjuanzi Status: ready -->
<sect1 xml:id="migration85.incompatible" xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>不向后兼容的变更</title>

 <sect2 xml:id="migration85.incompatible.core">
  <title>PHP 核心</title>

  <sect3 xml:id="migration85.incompatible.core.array-callable-alias">
   <title><literal>"array"</literal> 和 <literal>"callable"</literal> 别名</title>

   <simpara>
    在 <function>class_alias</function> 中，不再允许使用 <literal>"array"</literal> 和 <literal>"callable"</literal> 作为类的别名名称
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.loosely-comparing-object">
   <title>宽松比较不可比较的对象</title>

   <simpara>
    之前，对不可比较的对象（例如枚举、<classname>CurlHandle</classname> 和其他内部类）进行宽松布尔比较时存在不一致性。如果与布尔字面量
    <code>$object == true</code> 进行比较，则其行为与 <code>(bool)$object</code> 相同；如果与静态未知值 <code>$object == $true</code>
    进行比较，则始终返回 &false;。此行为现已统一，始终遵循 <code>(bool)$object</code> 的行为。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.gc-collect-cycles">
   <title>gc_collect_cycles 的返回值</title>

   <simpara>
    <function>gc_collect_cycles</function> 的返回值不再包括通过循环间接收集的字符串和资源。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.substitute-final-subclasses">
   <title>在 final 子类中替换 static 关键字</title>

   <simpara>
    现在允许在 final 子类中将 <type>static</type> 替换为 <type>self</type> 或具体类名。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.tick-handlers">
   <title>tick 处理程序</title>

   <simpara>
    tick 处理程序现在会在所有关闭函数和析构方法执行完毕、输出处理程序清理完成后停用。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.trait-binding">
   <title>Trait 绑定</title>

   <simpara>
    Trait 现在会在父类之前绑定。这是一个细微的行为变更，但更符合用户的预期。
    <!-- https://github.com/php/php-src/pull/15878 -->
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.errors-compilation-and-linking">
   <title>编译和类链接过程中的错误</title>

   <simpara>
    编译和类链接过程中产生的错误现在一律延迟处理，并在编译或类链接完成后统一处理。若在编译或类链接期间产生致命错误，将立即处理所有已延迟的错误，且不调用用户定义的错误处理程序。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.exception-by-userdefined-handler">
   <title>用户定义的错误处理程序抛出的异常</title>

   <simpara>
    用户定义的错误处理程序在处理类链接错误时抛出的异常，不再升级为致命错误，也不会阻止链接过程。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.attribute-during-compilation">
   <title>应用的注解在编译期间出错</title>

   <simpara>
    将 <code>#[\Attribute]</code> 应用于抽象类、枚举、接口或 Trait 时，会在编译期间触发错误。此前，该注解虽可添加，但在调用
    <methodname>ReflectionAttribute::newInstance</methodname> 时才会抛出错误。通过使用新的
    <code>#[\DelayedTargetValidation]</code> 注解，可将此错误从编译期延迟至运行时。
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.disable-ini-setting">
   <title>disable_classes INI 配置项</title>

   <simpara>
    已移除 <link linkend="ini.disable-classes">disable_classes</link> INI 配置项，因其会导致引擎的多项假设失效。
    <!-- RFC: https://wiki.php.net/rfc/deprecations_php_8_5#remove_disable_classes_ini_setting -->
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.destruct-non-array-values">
   <title>解构非数组值</title>

   <simpara>
    使用 <literal>[]</literal> 或 <function>list</function> 解构非数组值（&null; 除外）时，现在会发出警告。
    <!-- RFC: https://wiki.php.net/rfc/warnings-php-8-5#destructuring_non-array_values -->
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.incompatible.core.warning-related-to-cast">
   <title>Warnings related to cast</title>

   <simpara>
    当浮点数（或看起来像浮点数的字符串）无法精确表示为整数时，将其转换为整型会发出警告。此行为适用于显式和隐式的整型转换。
    <!-- RFC: https://wiki.php.net/rfc/warnings-php-8-5#casting_out_of_range_floats_to_int -->
   </simpara>

   <simpara>
    将 NAN 转换为其他类型时，现在会发出警告。
    <!-- RFC: https://wiki.php.net/rfc/warnings-php-8-5#coercing_nan_to_other_types -->
   </simpara>

  </sect3>

 </sect2>

 <sect2 xml:id="migration85.incompatible.bzip2">
  <title>Bzip2</title>

  <simpara>
   当 <parameter>$block_size</parameter> 不在 1 到 9 之间时，<function>bzcompress</function>
   现在会抛出 <classname>ValueError</classname>。
  </simpara>

  <simpara>
   当 <parameter>$work_factor</parameter> 不在 0 到 250 之间时，<function>bzcompress</function>
   现在会抛出 <classname>ValueError</classname>。
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.dom">
  <title>DOM</title>

  <simpara>
   现在克隆 <classname>DOMNamedNodeMap</classname>、<classname>DOMNodeList</classname>、<classname>Dom\NamedNodeMap</classname>、<classname>Dom\NodeList</classname>、<classname>Dom\HTMLCollection</classname>
   和 <classname>Dom\DtdNamedNodeMap</classname> 会失败。此前此类操作从未生成有效的对象，因此预计不会产生实际影响。
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.fileinfo">
  <title>FileInfo</title>

  <simpara>
   当 <parameter>$filename</parameter> 包含 nul 字节时，<function>finfo_file</function> 和
   <methodname>finfo::file</methodname> 现在抛出 <exceptionname>ValueError</exceptionname>
   而非 <exceptionname>TypeError</exceptionname>，以使抛出的错误类型与语言其他部分保持一致。
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.intl">
  <title>Intl</title>

  <simpara>
   该扩展现在要求最低 ICU 57.1。
  </simpara>

  <simpara>
   <methodname>IntlDateFormatter::setTimeZone</methodname>/<function>datefmt_set_timezone</function>
   在类未初始化或克隆失败时，现在会抛出 <exceptionname>IntlException</exceptionname>。
  </simpara>

  <simpara>
   所有 <classname>Locale</classname> 方法在 locale 参数包含 null 字节时，现在均抛出 <exceptionname>ValueError</exceptionname>。
  </simpara>

  <simpara>
   <constant>Collator::SORT_REGULAR</constant>在处理数字字符串时的行为现已与
   ext/standard 中的 <constant>SORT_REGULAR</constant> 保持一致。
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.ldap">
  <title>LDAP</title>

  <simpara>
   <function>ldap_get_option</function> 和 <function>ldap_set_option</function>
   当传递无效选项时现在抛出 <exceptionname>ValueError</exceptionname>。
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.mbstring">
  <title>MBString</title>

  <simpara>
   Unicode 数据表已更新至 Unicode 17.0
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.mysqli">
  <title>MySQLi</title>

  <simpara>
   对已构造的对象再次调用 mysqli 构造方法现已不可行，并会抛出 <exceptionname>Error</exceptionname>。
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.odbc">
  <title>ODBC</title>

  <simpara>
   ODBC now assumes that at least ODBC 3.5 functionality is available.
   The ODBCVER definition and build system flags to control it have been removed.
  </simpara>

  <simpara>
   ODBC no longer has build flags to build against specific drivers (except
   for DB2) and removes special cases for those drivers. It is strongly
   recommended to use a driver manager like iODBC or unixODBC on non-Windows.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.opcache">
  <title>Opcache</title>

  <simpara>
   The Opcache extension is now always built into the PHP binary and is always
   loaded.
   The INI directives <link linkend="ini.opcache.enable">opcache.enable</link>
   and <link linkend="ini.opcache.enable-cli">opcache.enable_cli</link> are still
   honored.
  </simpara>

  <simpara>
   The <option role="configure">--enable-opcache</option>/<option role="configure">--disable-opcache</option>
   configure flags have been removed, and the build does not produce <filename>opcache.so</filename>
   or <filename>php_opcache.dll</filename> objects anymore.
  </simpara>

  <simpara>
   Using <literal>zend_extension=opcache.so</literal> or
   <literal>zend_extension=php_opcache.dll</literal> INI directives
   will emit a warning.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.pcntl">
  <title>PCNTL</title>

  <simpara>
   <function>pcntl_exec</function> now throws <exceptionname>ValueError</exceptionname>
   when entries of the <parameter>$args</parameter> parameter contain null bytes.
  </simpara>

  <simpara>
   <function>pcntl_exec</function> now throws <exceptionname>ValueError</exceptionname>
   when entries or keys of the <parameter>$env_vars</parameter> parameter
   contain null bytes.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.pcre">
  <title>PCRE</title>

  <simpara>
   The extension is compiled without semi-deprecated
   PCRE2_EXTRA_ALLOW_LOOKAROUND_BSK compile option.
   <!-- https://github.com/PCRE2Project/pcre2/issues/736#issuecomment-2754024651 -->
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.pdo">
  <title>PDO</title>

  <simpara>
   The constructor arguments set in conjunction with
   <constant>PDO::FETCH_CLASS</constant> now follow the usual CUFA
   (<function>call_user_func_array</function>) semantics.
   This means string keys will act like a named argument.
   Moreover, automatic wrapping for by-value arguments passed to a by-ref
   parameter has been removed, and the usual <constant>E_WARNING</constant>
   about this is now emitted.
   To pass a variable by-ref to a constructor argument use the general
   array value reference assignment: <code>$ctor_args = [&amp;$valByRef]</code>
  </simpara>

  <simpara>
   Attempting to call <methodname>PDOStatement::setFetchMode</methodname> during
   a call to <methodname>PDO::fetch</methodname>,
   <methodname>PDO::fetchObject</methodname>,
   <methodname>PDO::fetchAll</methodname>, for example using tricks such as
   passing the statement object as a constructor argument when fetching into an
   object, will now throw an <exceptionname>Error</exceptionname>.
  </simpara>

  <simpara>
   The value of the constants <constant>PDO::FETCH_GROUP</constant>,
   <constant>PDO::FETCH_UNIQUE</constant>,
   <constant>PDO::FETCH_CLASSTYPE</constant>,
   <constant>PDO::FETCH_PROPS_LATE</constant>, and
   <constant>PDO::FETCH_SERIALIZE</constant> have changed.
  </simpara>

  <simpara>
   A <exceptionname>ValueError</exceptionname> is now thrown if
   <constant>PDO::FETCH_PROPS_LATE</constant> is used with a fetch mode
   different than <constant>PDO::FETCH_CLASS</constant>, consistent with
   other fetch flags.
  </simpara>

  <simpara>
   A <exceptionname>ValueError</exceptionname> is now thrown if
   <constant>PDO::FETCH_INTO</constant> is used as a fetch mode in
   <methodname>PDO::fetchAll</methodname>,
   similar to <constant>PDO::FETCH_LAZY</constant>.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.pdo-firebird">
  <title>PDO_FIREBIRD</title>

  <simpara>
   A <exceptionname>ValueError</exceptionname> is now thrown when trying to set a cursor
   name that is too long on a <classname>PDOStatement</classname> resulting from
   the Firebird driver.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.pdo-sqlite">
  <title>PDO_SQLITE</title>

  <simpara>
   SQLite <methodname>PDO::quote</methodname> will now throw an exception
   or emit a warning, depending on the error mode, if the string contains
   a null byte.
  </simpara>

  <simpara>
   <methodname>PDO::sqliteCreateCollation</methodname> will now throw an
   exception if the callback has the wrong return type, making it more
   in line with <methodname>Pdo\Sqlite::createCollation</methodname> behavior.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.posix">
  <title>POSIX</title>

  <simpara>
   <function>posix_kill</function> now throws a
   <exceptionname>ValueError</exceptionname> when the process_id argument is
   lower or greater than what the platform supports (signed integer or
   long range), <function>posix_setpgid</function> now throws a
   <exceptionname>ValueError</exceptionname> when the process_id or
   the process_group_id is lower than zero or greater than what the platform
   supports.
  </simpara>

  <simpara>
   <function>posix_setrlimit</function> now throws a
   <exceptionname>ValueError</exceptionname> when the hard_limit or
   soft_limit arguments are lower than -1 or if soft_limit is greater than
   hard_limit.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.reflection">
  <title>Reflection</title>

  <simpara>
   <methodname>ReflectionAttribute::newInstance</methodname> can now throw
   errors for internal attributes if the attribute was applied on an invalid
   target and the error was delayed from compile time to runtime via the
   #[\DelayedTargetValidation] attribute.
   <!-- RFC: https://wiki.php.net/rfc/delayedtargetvalidation_attribute -->
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.session">
  <title>Session</title>

  <simpara>
   Attempting to write session data where <varname>$_SESSION</varname> has a key
   containing the pipe character (<literal>|</literal>) will now emit a warning
   instead of silently failing.
  </simpara>

  <simpara>
   <function>session_start</function> is stricter in regard to the options
   argument. It now throws a <exceptionname>ValueError</exceptionname> if
   the array is not a hashmap, or a <exceptionname>TypeError</exceptionname>
   if the read_and_close value is not a valid type compatible with int.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.simplexml">
  <title>SimpleXML</title>

  <simpara>
   Passing an XPath expression that returns something other than a node set
   to <methodname>SimpleXMLElement::xpath</methodname> will now emit a warning
   and return &false;, instead of silently failing and returning an empty array.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.snmp">
  <title>SNMP</title>

  <simpara>
   <function>snmpget</function>,
   <function>snmpset</function>,
   <function>snmp2_get</function>,
   <function>snmp2_set</function>,
   <function>snmp3_get</function>,
   <function>snmp3_set</function>
   and <methodname>SNMP::__construct</methodname> now throw a
   <exceptionname>ValueError</exceptionname> when the hostname
   is too large, contains any null byte or if the port is given
   when negative or greater than 65535, timeout and retries values
   are lower than -1 or too large.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.soap">
  <title>SOAP</title>

  <simpara>
   <methodname>SoapClient::__doRequest</methodname> now accepts a new,
   optional <parameter>$uriParserClass</parameter> parameter accepting
   string or &null; arguments.
   &null; represents the original (<function>parse_url</function>) based
   method, while the new backends will be used when passing either
   <classname>Uri\Rfc3986\Uri</classname> or <classname>Uri\WhatWg\Url</classname>.
   <!-- RFC: https://wiki.php.net/rfc/url_parsing_api#plugability -->
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.sockets">
  <title>Sockets</title>

  <simpara>
   <function>socket_create_listen</function>,
   <function>socket_bind</function> and <function>socket_sendto</function>
   now throw a <exceptionname>ValueError</exceptionname> if the port is lower
   than 0 or greater than 65535, and also if any of the hints array entries are
   indexed numerically.
  </simpara>

  <simpara>
   <function>socket_addrinfo_lookup</function> now throws a
   <exceptionname>TypeError</exceptionname> if any of the hints values cannot
   be cast to int and can throw a <exceptionname>ValueError</exceptionname> if
   any of these values overflow.
  </simpara>

  <simpara>
   <function>socket_set_option</function> with
   <constant>MCAST_LEAVE_GROUP</constant>/<constant>MCAST_LEAVE_SOURCE_GROUP</constant>
   options now throw an exception if the value isn't a valid object or array.
  </simpara>

  <simpara>
   <function>socket_set_option</function> with multicast context now throws a
   <exceptionname>ValueError</exceptionname> when the created socket is not of
   <constant>AF_INET</constant>/<constant>AF_INET6</constant> family.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.spl">
  <title>SPL</title>

  <simpara>
   <classname>ArrayObject</classname> no longer accepts enums, as modifying the
   <property>$name</property> or <property>$value</property> properties can break
   engine assumptions.
  </simpara>

  <simpara>
   <methodname>SplFileObject::fwrite</methodname>'s parameter
   <parameter>$length</parameter> is now nullable.
   The default value changed from <literal>0</literal> to &null;.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.standard">
  <title>Standard</title>

  <simpara>
   Using a printf-family function with a formatter that did not specify the
   precision previously incorrectly reset the precision instead of treating
   it as a precision of 0.
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.incompatible.tidy">
  <title>Tidy</title>

  <simpara>
   <methodname>tidy::__construct</methodname>,
   <methodname>tidy::parseFile</methodname>,
   <methodname>tidy::parseString</methodname> now throws a
   <exceptionname>ValueError</exceptionname> if the configuration contains an
   invalid value or attempts to set a read-only internal entry,
   and a <exceptionname>TypeError</exceptionname> if a configuration key is not a
   string.
  </simpara>

 </sect2>

</sect1>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
