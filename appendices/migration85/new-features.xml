<?xml version="1.0" encoding="utf-8"?>
<!-- EN-Revision: ec45af749649dc0d6a23eaedeed1b601f7460813 Maintainer: mowangjuanzi Status: ready -->
<sect1 xml:id="migration85.new-features" xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>新功能</title>

 <sect2 xml:id="migration85.new-features.core">
  <title>PHP 核心</title>

  <sect3 xml:id="migration85.new-features.core.pipe-operator">
   <title>管道运算符</title>

   <simpara>
    新增<link linkend="language.operators.functional">管道（<literal>|&gt;</literal>）运算符</link>。
    <!-- RFC: https://wiki.php.net/rfc/pipe-operator-v3 -->
   </simpara>

   <informalexample>
    <programlisting role="php">
<![CDATA[
<?php
$result = "Hello World" |> strlen(...);
print $result . PHP_EOL;  // Prints "11"
]]>
    </programlisting>
   </informalexample>
  </sect3>

  <sect3 xml:id="migration85.new-features.core.closures-in-constexpr">
   <title>常量表达式中的闭包</title>

   <para>
    在常量表达式中新增对<link linkend="class.closure">闭包</link>和<link
    linkend="functions.first_class_callable_syntax">一级可调用对象</link>的支持，包括：

    <simplelist>
     <member>注解参数。</member>
     <member>属性和参数的默认值。</member>
     <member>常量和类常量。</member>
    </simplelist>

    <!-- RFC: https://wiki.php.net/rfc/closures_in_const_expr -->
    <!-- RFC: https://wiki.php.net/rfc/fcc_in_const_expr -->
   </para>
  </sect3>

  <sect3 xml:id="migration85.new-features.core.nodiscard-attribute">
   <title>#[\NoDiscard] 注解</title>

   <simpara>
    新增了 <classname>NoDiscard</classname> 注解，用于表示函数的返回值是重要的，应当使用它。
    <!-- RFC: https://wiki.php.net/rfc/marking_return_value_as_important -->
   </simpara>

   <simpara>
    同时，新增 <literal>(void)</literal> 转换以表明不使用某个值是故意的。<literal>(void)</literal>
    转换本身对程序执行没有任何影响，但可以用来抑制 <code>#[\NoDiscard]</code> 发出的警告，也可能用于消除外部
    IDE 或静态分析工具发出的诊断信息。
    <!-- RFC: https://wiki.php.net/rfc/marking_return_value_as_important -->
   </simpara>

   <informalexample>
    <programlisting role="php">
<![CDATA[
<?php

#[\NoDiscard]
function concat(string $a, string $b): string {
     return a + b;
}

// concat() 的返回值应要么被使用，要么通过在 xxx.php 中将其强制转换为 (void) 来有意忽略。
concat("a", "b");

// 不会发出警告，因为返回值已被赋值操作使用。
$results = concat("a", "b");

// 不会发出警告，因为使用了 (void) 转换。
(void)concat("a", "b");
]]>
    </programlisting>
   </informalexample>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.attributes-on-constants">
   <title>常量上的注解</title>

   <simpara>
    新增对编译时非类常量的注解支持（例如，<code>const MY_CONST = 1;</code> 而非 <code>define('MY_CONST', 1);</code>）。
    <!-- RFC: https://wiki.php.net/rfc/attributes-on-constants -->
   </simpara>

   <simpara>
    <classname>Deprecated</classname> 注解现在可以用于常量。
    <!-- RFC: https://wiki.php.net/rfc/attributes-on-constants -->
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.delayedtargetvalidation-attribute">
   <title><code>#[\DelayedTargetValidation]</code> 注解</title>

   <simpara>
    新增的 <classname>DelayedTargetValidation</classname>
    注解可用于抑制在无效目标上使用核心（或扩展）注解时产生的编译时错误。这些错误会在调用
    <methodname>ReflectionAttribute::newInstance</methodname> 时于运行时报告（如果需要）。
    <!-- RFC: https://wiki.php.net/rfc/delayedtargetvalidation_attribute -->
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.override-for-properties">
   <title>用于属性的 <code>#[\Override]</code></title>

   <simpara>
    <classname>Override</classname> 注解现在可应用于属性。
    <!-- RFC: https://wiki.php.net/rfc/override_properties -->
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.static-aviz">
   <title>静态非对称可见性</title>

   <simpara>
    新增对静态属性的<link linkend="language.oop5.visibility-members-aviz">非对称可见性支持</link>。
    <!-- RFC: https://wiki.php.net/rfc/static-aviz -->
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.backtraces-for-fatal-errors">
   <title>Fatal Error 的 Backtraces</title>

   <simpara>
    Fatal Error（例如超出最大执行时间）现在包含回溯信息。
    <!-- RFC: https://wiki.php.net/rfc/error_backtraces_v2 -->
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.final-property-promotion">
   <title>final 属性的构造方法提升</title>

   <simpara>
    <link linkend="language.oop5.decon.constructor.promotion">构造方法属性提升</link>现在可以用于最终属性。
    <!-- RFC: https://wiki.php.net/rfc/final_promotion -->
   </simpara>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.casts-in-constexpr">
   <title>常量表达式中的类型转换</title>

   <simpara>
    新增对常量表达式中类型转换的支持。
   </simpara>

   <informalexample>
    <programlisting role="php">
<![CDATA[
<?php
const T1 = (int) 0.3; // 之前：“Fatal error: Constant expression contains invalid operations”
print T1 . PHP_EOL;   // 打印“0”
]]>
    </programlisting>
   </informalexample>

  </sect3>

  <sect3 xml:id="migration85.new-features.core.clone-function">
   <title>Clone 函数</title>

   <simpara>
    <link linkend="language.oop5.cloning">clone 语言结构</link>现在是函数，并通过新的
    <property>$withProperties</property> 参数支持在克隆期间重新分配（只读）属性。
    <!-- RFC: https://wiki.php.net/rfc/clone_with_v2 -->
   </simpara>

  </sect3>

 </sect2>

 <sect2 xml:id="migration85.new-features.curl">
  <title>cURL</title>

  <simpara>
   新增对多个 PHP 请求之间持久化的<link
   linkend="class.curlsharepersistenthandle">共享句柄</link>的支持，从而安全地实现更高效的连接复用。
   <!-- RFC: https://wiki.php.net/rfc/curl_share_persistence_improvement -->
  </simpara>

  <simpara>
   <function>curl_getinfo</function> 函数新增对 <constant>CURLINFO_USED_PROXY</constant>（libcurl
   >= 8.7.0）、<constant>CURLINFO_HTTPAUTH_USED</constant> 和 <constant>CURLINFO_PROXYAUTH_USED</constant>（libcurl
   >= 8.12.0）的支持。当 <function>curl_getinfo</function> 返回数组时，相同的信息可通过
   <literal>"used_proxy"</literal>、<literal>"httpauth_used"</literal> 和 <literal>"proxyauth_used"</literal> key
   获取。如果上一次传输未使用代理，将设置 <constant>CURLINFO_USED_PROXY</constant>
   为零；如果使用了代理，则为非零值。<constant>CURLINFO_HTTPAUTH_USED</constant> 和 <constant>CURLINFO_PROXYAUTH_USED</constant>
   将返回位掩码，表示上一次请求中使用的 HTTP 和代理认证方法。有关可能的值，请参阅
   <constant>CURLAUTH_<replaceable>*</replaceable></constant> 常量。
  </simpara>

  <simpara>
   新增 <constant>CURLOPT_INFILESIZE_LARGE</constant> Curl 选项，作为 <constant>CURLOPT_INFILESIZE</constant>
   的安全替代。在某些系统上，即使是在 64 位系统中，<constant>CURLOPT_INFILESIZE</constant> 也仅接受 32
   位有符号整数作为文件大小（2.0 GiB）。而 <constant>CURLOPT_INFILESIZE_LARGE</constant> 可接受系统能够处理的最大整数值。
  </simpara>

  <simpara>
   为 <function>curl_setopt</function> 的 <constant>CURLOPT_FOLLOWLOCATION</constant> 选项新增了
   <constant>CURLFOLLOW_OBEYCODE</constant>、<constant>CURLFOLLOW_FIRSTONLY</constant> 和 <constant>CURLFOLLOW_ALL</constant>
   值。<constant>CURLFOLLOW_OBEYCODE</constant> 在允许重定向的情况下，会更严格地遵循重定向规则。<constant>CURLFOLLOW_FIRSTONLY</constant>
   仅跟随第一次重定向，因此如果有后续的重定向，则不会继续跟进。<constant>CURLFOLLOW_ALL</constant> 等同于将
   <constant>CURLOPT_FOLLOWLOCATION</constant> 设置为 true。
  </simpara>

  <simpara>
   <function>curl_getinfo</function> 函数新增对 <constant>CURLINFO_CONN_ID</constant>（libcurl >= 8.2.0）的支持。该常量可用于获取 cURL
   传输的连接唯一 ID。当需要在 PHP 层面实现连接复用或连接池逻辑时，该功能尤其有用。当 <function>curl_getinfo</function> 返回数组时，该值可通过
   <literal>"conn_id"</literal> key 获取。
  </simpara>

  <simpara>
   <function>curl_getinfo</function> 函数新增对 <constant>CURLINFO_QUEUE_TIME_T</constant>（libcurl >=
   8.6.0）的支持。该常量可用于获取请求发送之前在 libcurl 的连接队列中等待的时间（以微秒为单位）。通过将
   <constant>CURLINFO_QUEUE_TIME_T</constant> 传递给 <function>curl_getinfo</function> 的
   <parameter>option</parameter> 参数，也可以获取该值。
  </simpara>

  <simpara>
   新增对 <constant>CURLOPT_SSL_SIGNATURE_ALGORITHMS</constant> 的支持，用于指定 TLS 的签名算法。
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.dom">
  <title>DOM</title>

  <simpara>
   新增 <property>Dom\Element::$outerHTML</property>。
  </simpara>

  <simpara>
   在 <interfacename>Dom\ParentNode</interfacename> 实现中新增了 <property>$children</property> 属性。
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.exif">
  <title>EXIF</title>

  <simpara>
   新增对 <literal>OffsetTime*</literal> Exif 标签的支持。
  </simpara>

  <simpara>
   新增对 HEIF/HEIC 的支持。
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.filter">
  <title>Filter</title>

  <simpara>
   新增 <constant>FILTER_THROW_ON_FAILURE</constant> flag，可传递给过滤函数，并在验证失败时强制触发异常。此
   flag 无法与 <constant>FILTER_NULL_ON_FAILURE</constant> 结合使用，尝试这样做将导致抛出
   <exceptionname>ValueError</exceptionname>。
   <!-- RFC: https://wiki.php.net/rfc/filter_throw_on_failure -->
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.intl">
  <title>Intl</title>

  <simpara>
   新增与多种货币相关数字格式对应的类常量：<constant>NumberFormatter::CURRENCY_ISO</constant>、<constant>NumberFormatter::CURRENCY_PLURAL</constant>、<constant>NumberFormatter::CASH_CURRENCY</constant>,
   和 <constant>NumberFormatter::CURRENCY_STANDARD</constant>。
  </simpara>

  <simpara>
   新增 <methodname>Locale::addLikelySubtags</methodname> 和 <methodname>Locale::minimizeSubtags</methodname>
   方法，用于处理指定 locale 的可能标签。
  </simpara>

  <simpara>
   新增 <classname>IntlListFormatter</classname> 类，用于根据指定 locale 对项目列表进行格式化、排序和标点处理，支持
   <constant>IntlListFormatter::TYPE_AND</constant>、<constant>IntlListFormatter::TYPE_OR</constant>、<constant>IntlListFormatter::TYPE_UNITS</constant>
   操作数，以及 <constant>IntlListFormatter::WIDTH_WIDE</constant>、<constant>IntlListFormatter::WIDTH_SHORT</constant> 和
   <constant>IntlListFormatter::WIDTH_NARROW</constant> 宽度。该功能从 icu 67 版本开始支持。
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.pdo-sqlite">
  <title>PDO_Sqlite</title>

  <simpara>
   新增类常量 <constant>Pdo\Sqlite::ATTR_BUSY_STATEMENT</constant>。
  </simpara>

  <simpara>
   新增类常量 <constant>Pdo\Sqlite::ATTR_EXPLAIN_STATEMENT</constant>、<constant>Pdo\Sqlite::EXPLAIN_MODE_PREPARED</constant>、<constant>Pdo\Sqlite::EXPLAIN_MODE_EXPLAIN</constant>
   和 <constant>Pdo\Sqlite::EXPLAIN_MODE_EXPLAIN_QUERY_PLAN</constant>。
  </simpara>

  <simpara>
   新增 <constant>Pdo\Sqlite::ATTR_TRANSACTION_MODE</constant> 连接注解，可选值包括
   <constant>Pdo\Sqlite::TRANSACTION_MODE_DEFERRED</constant>、<constant>Pdo\Sqlite::TRANSACTION_MODE_IMMEDIATE</constant>
   和 <constant>Pdo\Sqlite::TRANSACTION_MODE_EXCLUSIVE</constant>，用于配置调用 beginTransaction() 时使用的事务模式。
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.session">
  <title>Session</title>

  <simpara>
   <function>session_set_cookie_params</function>、<function>session_get_cookie_params</function>
   和 <function>session_start</function> 现在通过 <literal>"partitioned"</literal> key 支持分区 cookie。
   <!-- RFC: https://wiki.php.net/rfc/CHIPS -->
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.soap">
  <title>SOAP</title>

  <simpara>
   枚举项现在会在 <methodname>SoapClient::__getTypes</methodname> 中输出。
  </simpara>

  <simpara>
   新增对 SOAP 1.2 Reason Text 的 xml:lang 属性的支持。
  </simpara>

  <simpara>
   因此，<methodname>SoapFault::__construct</methodname> 和 <methodname>SoapServer::fault</methodname>
   的签名现在包含可选的 <parameter>$lang</parameter> 参数。该支持解决了与 .NET SOAP 客户端的兼容性问题。
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.standard">
  <title>标准</title>

  <simpara>
   <function>mail</function> 函数现在会返回实际的 sendmail 错误，并能检测 sendmail
   进程是否意外终止。若发生此类情况，将发出警告并返回 false。此前会静默忽略这些错误。此变更仅影响 sendmail 的传输。
  </simpara>

  <simpara>
   <function>getimagesize</function> 现在支持 HEIF/HEIC 图像。
  </simpara>

  <simpara>
   当加载 ext-libxml 扩展时，<function>getimagesize</function> 现已支持 SVG
   图像。同样，<function>image_type_to_extension</function> 和 <function>image_type_to_mime_type</function> 现也处理 IMAGETYPE_SVG。
  </simpara>

  <simpara>
   <function>getimagesize</function> 返回的数组现在包含两个额外的条目：<literal>"width_unit"</literal> 和
   <literal>"height_unit"</literal>，用于表示尺寸所使用的单位。这些单位默认为 px。这两个单位不一定相同（例如，一个可能是
   cm，另一个可能是 px）。
  </simpara>

  <simpara>
   <function>setcookie</function> 和 <function>setrawcookie</function> 现在支持
   <literal>"partitioned"</literal> key。
   <!-- RFC: https://wiki.php.net/rfc/CHIPS -->
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.uri">
  <title>URI</title>

  <simpara>
   新增始终启用的 URI 扩展，可用于根据 RFC 3986 和 WHATWG URL 规范处理 URI 和 URL。
   <!-- RFC: https://wiki.php.net/rfc/url_parsing_api -->
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.xsl">
  <title>XSL</title>

  <simpara>
   <methodname>XSLTProcessor::getParameter</methodname>、<methodname>XSLTProcessor::setParameter</methodname> 和
   <methodname>XSLTProcessor::removeParameter</methodname> 的 <parameter>$namespace</parameter>
   参数现已生效，不再视为空值。此功能仅在 <parameter>$name</parameter> 参数未使用 Clark 表示法且不是 QName
   时有效，因为在这些情况下，命名空间分别取自命名空间的 href 或前缀。
  </simpara>

 </sect2>

 <sect2 xml:id="migration85.new-features.zlib">
  <title>Zlib</title>

  <simpara>
   <function>flock</function> 现已支持 zlib 流。此前，该函数始终无法执行任何锁定操作。
  </simpara>

 </sect2>

</sect1>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
