<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision$ -->
<!-- EN-Revision: 8b6d169424ff189bb563ef4c3f35f8adff3f42c5 Maintainer: dallas Status: partial -->

<sect1 xml:id="install.windows.iis6" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>Microsoft IIS 5.1 和 IIS 6.0</title>
 <para>
  本章包含有在 Windows XP 和 Windows Server 2003 下的
  Internet 信息服务（IIS）5.1 和 IIS 6.0 中安装 PHP 的指南。有关在
  Windows Vista，Windows Server 2008，Windows 7 以及 Windows Server 2008 R2
  下的 IIS 7.0 以及更高版本中安装 PHP 的指南见
  <link linkend="install.windows.iis7">Microsoft IIS 7.0 及更高版本</link>一章。
 </para>
 <sect2 xml:id="install.windows.iis6.fastcgi">
  <title>配置 IIS 以处理 PHP 请求</title>
  <para>
   根据<link linkend="install.windows.manual">手工安装步骤</link>的说明下载和安装 PHP。
   <note>
    <para>
     在使用 IIS 时推荐使用非线程安全的 PHP。可以在
	 <link xlink:href="&url.php.win.downloads;">PHP for Windows: 
     Binaries and Sources Releases</link> 下载。
    </para>
   </note>
  </para>
  <para>
   按以下示例在 <filename>php.ini</filename> 文件中配置
   针对 CGI- 和 FastCGI- 的指令：
   <example>
    <title><filename>php.ini</filename> 中的 CGI 和 FastCGI 设定</title>
    <programlisting role="ini">
<![CDATA[
fastcgi.impersonate = 1
fastcgi.logging = 0
cgi.fix_pathinfo=1
cgi.force_redirect = 0
]]>
    </programlisting>
   </example>
  </para>
  <para>
   下载并安装 <link xlink:href="&url.iis.fastcgi.downloads;">FastCGI for
   IIS</link>。有 32 位和 64 位平台的，根据用户平台选择相应的下载。
  </para>
  <para>
   用以下命令配置 FastCGI 扩展处理 PHP 请求。用指向
   <filename>php-cgi.exe</filename> 文件的绝对路径替换其中的 &quot;-path&quot; 的参数。
   <example>
    <title>配置 FastCGI 扩展以处理 PHP 请求</title>
    <programlisting>
<![CDATA[
cscript %windir%\system32\inetsrv\fcgiconfig.js -add -section:"PHP" ^
-extension:php -path:"C:\PHP\php-cgi.exe"
]]>
    </programlisting>
   </example>
  </para>
  <para>
   
   This command will create an IIS script mapping for *.php file extension, which will result in all URLs 
   that end with .php being handled by FastCGI extension. Also, it will configure FastCGI extension to 
   use the executable <filename>php-cgi.exe</filename> to process the PHP requests.
   <note>
     <para>
      At this point the required installation and configuration steps are completed. The remaining 
      instructions below are optional but highly recommended for achieving optimal functionality 
      and performance of PHP on IIS.
     </para>
   </note>
  </para>
 </sect2>
 <sect2 xml:id="install.windows.iis6.impersonation">
  <title>Impersonation and file system access</title>
  <para>
   It is recommended to enable FastCGI impersonation in PHP when using IIS. This 
   is controlled by the <varname>fastcgi.impersonate</varname> directive in <filename>php.ini</filename> file. When 
   impersonation is enabled, PHP will perform all the file system operations on 
   behalf of the user account that has been determined by IIS authentication. This 
   ensures that even if the same PHP process is shared across different IIS web 
   sites, the PHP scripts in those web sites will not be able to access each 
   others&#39; files as long as different user accounts are used for IIS authentication 
   on each web site.
  </para>
  <para>
   For example IIS 5.1 and IIS 6.0, in its default configuration, has anonymous authentication enabled 
   with built-in user account IUSR_&lt;MACHINE_NAME&gt; used as a default identity. This means that in 
   order for IIS to execute PHP scripts, it is necessary to grant IUSR_&lt;MACHINE_NAME&gt; account 
   read permission on those scripts. If PHP applications need to perform write operations on certain 
   files or write files into some folders then IUSR_&lt;MACHINE_NAME&gt; account should have write permission to those.
  </para>
  <para>
   To determine which user account is used by IIS anonymous authentication, follow these steps:
   <procedure>
    <step>
     <simpara>In the Windows Start Menu choose &quot;Run:&quot;, type &quot;inetmgr&quot; and click &quot;Ok&quot;;</simpara>
    </step>
    <step>
     <simpara>Expand the list of web sites under the &quot;Web Sites&quot; node in the tree view, right-click on a web 
      site that is being used and select &quot;Properties&quot;;
     </simpara>    
    </step>
    <step>
     <simpara>Click the &quot;Directory Security&quot; tab;</simpara>    
    </step>
    <step>
     <simpara>Take note of a &quot;User name:&quot; field in the &quot;Authentication Methods&quot; dialog</simpara>
    </step>
   </procedure>
   <mediaobject>
    <alt>Anonymous authenication for IIS 5.1 and IIS 6.0</alt>
    <imageobject>
     <imagedata fileref="en/install/windows/figures/iis6anonauth.png" width="654" depth="461" />
    </imageobject>
   </mediaobject>
  </para>
  <para>
   To modify the permissions settings on files and folders, use the Windows Explorer user interface 
   or <varname>icacls</varname> command.
   <example>
    <title>Configuring file access permissions</title>
    <programlisting>
<![CDATA[
icacls C:\inetpub\wwwroot\upload /grant IUSR:(OI)(CI)(M)
]]>     
    </programlisting>
   </example>
  </para>
 </sect2>
 <sect2 xml:id="install.windows.iis6.defaultdoc">
  <title>Set <filename>index.php</filename> as a default document in IIS</title>
  <para>
   The IIS default documents are used for HTTP requests that do not specify a document name. With PHP applications, 
   <filename>index.php</filename> usually acts as a default document. To add <filename>index.php</filename> to the list of 
   IIS default documents, follow these steps:
   <procedure>
    <step>
     <simpara>In the Windows Start Menu choose &quot;Run:&quot;, type &quot;inetmgr&quot; and click &quot;Ok&quot;;</simpara>
    </step>
    <step>
     <simpara>Right-click on the &quot;Web Sites&quot; node in the tree view and select &quot;Properties&quot;;</simpara>
    </step>
    <step>
     <simpara>Click the &quot;Documents&quot; tab;</simpara>
    </step>
    <step>
     <simpara>Click the &quot;Add...&quot; button and enter &quot;index.php&quot; for the &quot;Default content page:&quot;.</simpara>
    </step>
   </procedure>
   <mediaobject>
    <alt>Setting index.php as default document for IIS</alt>
    <imageobject>
     <imagedata fileref="en/install/windows/figures/iis6defaultdoc.png" width="659" depth="465" />
    </imageobject>
   </mediaobject>
  </para>
 </sect2>
 <sect2 xml:id="install.windows.iis6.recycling">
  <title>FastCGI and PHP Recycling configuration</title>
  <para>
   Configure IIS FastCGI extension settings for recycling of PHP processes by using the commands shown below. 
   The FastCGI setting <varname>instanceMaxRequests</varname> controls how many requests will be processed by a single 
   <filename>php-cgi.exe</filename> process before FastCGI extension shuts it down. The PHP environment variable 
   <varname>PHP_FCGI_MAX_REQUESTS</varname> controls how many requests a single <filename>php-cgi.exe</filename> process 
   will handle before it recycles itself. Make sure that the value specified for FastCGI <varname>InstanceMaxRequests</varname>
   setting is less than or equal to the value specified for <varname>PHP_FCGI_MAX_REQUESTS</varname>.
   <example>
    <title>Configuring FastCGI and PHP recycling</title>
    <programlisting>
<![CDATA[
cscript %windir%\system32\inetsrv\fcgiconfig.js -set -section:"PHP" ^
-InstanceMaxRequests:10000

cscript %windir%\system32\inetsrv\fcgiconfig.js -set -section:"PHP" ^
-EnvironmentVars:PHP_FCGI_MAX_REQUESTS:10000
]]>     
    </programlisting>
   </example>
  </para>
 </sect2>
 <sect2 xml:id="install.windows.iis6.timeouts">
  <title>Configuring FastCGI timeout settings</title>
  <para>
   Increase the timeout settings for FastCGI extension if there are applications that have long running PHP scripts. 
   The two settings that control timeouts are <varname>ActivityTimeout</varname> and <varname>RequestTimeout</varname>. 
   Refer to <link xlink:href="&url.iis.fastcgi.settings;">Configuring FastCGI Extension for IIS 6.0</link> for more 
   information about those settings.
   <example>
    <title>Configuring FastCGI timeout settings</title>
    <programlisting>
<![CDATA[
cscript %windir%\system32\inetsrv\fcgiconfig.js -set -section:"PHP" ^
-ActivityTimeout:90

cscript %windir%\system32\inetsrv\fcgiconfig.js -set -section:"PHP" ^
-RequestTimeout:90
]]>     
    </programlisting>
   </example>
   </para>
 </sect2>
 <sect2 xml:id="install.windows.iis6.phpinilocation">
  <title>Changing the Location of <filename>php.ini</filename> file</title>
  <para>
   PHP searches for <filename>php.ini</filename> file in 
   <link linkend="configuration.file">several locations</link> and it is 
   possible to change the default locations of <filename>php.ini</filename> 
   file by using <varname>PHPRC</varname> environment variable. To instruct PHP 
   to load the configuration file from a custom location run the command shown below. 
   The absolute path to the directory with <filename>php.ini</filename> file should be 
   specified as a value of <varname>PHPRC</varname> environment variable.
   <example>
    <title>Changing the location of <filename>php.ini</filename> file</title>
    <programlisting>
<![CDATA[
cscript %windir%\system32\inetsrv\fcgiconfig.js -set -section:"PHP" ^
-EnvironmentVars:PHPRC:"C:\Some\Directory\"
]]>         
    </programlisting>
   </example>
  </para>
 </sect2>
</sect1>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
